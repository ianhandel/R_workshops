---
title: "Alien Data - Example Analysis"
author: "Your name here"
date: "2018-04-04"
output:
  html_document:
    keep_md: true
    code_folding: show
    highlight: tango
    toc: yes
    toc_float:
      toc_collapsed: yes
---

(Install) and load 'add-in' packages

```{r, message=FALSE, warning=FALSE}
# install these packages if they are not already there...
if (!require("here")) install.packages("here")
if (!require("skimr")) install.packages("skimr")

# load main packages for this analysis
library(tidyverse) # to tidy, manipulate and explore data
library(readxl) # to import data from Excel
library(here) # to make referring to files and folders consistent
library(skimr) # nice quick summaries of data sets
```

### Import data

```{r}
alien_file <- here("data", "data_alien-observational-untidy_20180310.xlsx") 
alien <- read_excel(alien_file, sheet = 1, na = "*")
skim(alien)
```

### Tidy and clean data

Make subject a 'text' id rather than a number, padding with zeros.

```{r}
alien <- alien %>% 
  mutate(subject = str_pad(subject, width = 3, side = "left", "0"),
         subject = str_c("A", subject))
```

Rename columns that don't follow 'rules'

```{r}
alien <- alien %>% 
  rename(colour = `alien colour`,
         sex = `sex (male/female)`,
         IQ = `IQ - ref to human 100 scale!`)
```

Have a look at the colours...

```{r}
alien %>%
  count(colour)
```


Colour column has mixed capitalisation - make all lower case

```{r}
alien <- alien %>% 
  mutate(colour = str_to_lower(colour))
```

Have a look at the sexes...

```{r}
alien %>%
  count(sex)
```

Make sexes all 'm' or 'f' using first letter

```{r}
alien <- alien %>% 
  mutate(sex = str_sub(sex, 1, 1),
         sex = str_to_lower(sex))
```

Convert months to years

```{r}
alien <- alien %>% 
  mutate(age = if_else(str_detect(age, "months"),
                       parse_number(age) / 12,
                       parse_number(age)))
```

See how data looks so far...

```{r}
skim(alien)
```

Make iron column into a number (double in R speak)

```{r}
alien <- alien %>% 
  mutate(iron = parse_number(iron))
```

Right that looks to be the data 'tidy and clean'. Now some exploratory analysis.

### Explore categorical data

Tabulate colour...
```{r}
alien %>%
  count(colour)
```

Tabulate colour vs sex...
```{r}
alien %>%
  count(colour, sex)
```

### Explore numerical data

Mean glucose level
```{r}
alien %>%
  summarise(mean(glucose))
```

Mean and sd glucose
```{r}
alien %>% 
  summarise(mean(glucose),
            sd(glucose),
            min(glucose),
            max(glucose))
```

How about seeing if there's a sex difference?
```{r}
alien %>%
  group_by(sex) %>% 
  summarise(mean(glucose),
            sd(glucose),
            min(glucose),
            max(glucose))
```


### Some graphics

Plot to show frequency of different spottinesses
```{r}
ggplot(alien) +
  aes(x = health, fill = health) +
  geom_bar() +
  labs(title = "The alien health",
       x = "Health",
       y = "Count")
```

Plot to show frequency of different colours...
```{r}
ggplot(alien) +
  aes(x = colour, fill = colour) +
  geom_bar() +
  scale_fill_identity() +
  labs(title = "The alien colours",
       x = "Colour",
       y = "Count")
```

Single numerical variables. Look at gluoce levels...
```{r}
ggplot(alien) +
  aes(x = glucose) +
  geom_histogram() +
  facet_wrap(~ sex, ncol = 1) +
  labs(title = "Alien glucose level",
       x = "Glucose (mg/L)")
```

Scatterplot - age vs glucose
```{r}
ggplot(alien) +
  aes(x = age, y = glucose, colour = sex) +
  geom_point() +
  labs(title = "Alien glucose vs age")
```


Glucose levels for different colours

```{r}
ggplot(alien) +
  aes(x = glucose, fill = colour) +
  geom_histogram() +
  facet_wrap(~ colour) +
  scale_fill_identity() +
  labs(title = "Alien glucose vs colour")
```

### A hypothesis test

Does the mean weight of male aliens differ from that of female aliens?

First a plot...
```{r}
ggplot(alien) +
  aes(x = weight) +
  geom_histogram() +
  facet_wrap(~ sex, ncol = 1)
```

Then a T-Test (nul hypothesis mean(female) == mean(male))

```{r}
t.test(weight ~ sex, data = alien)
```

### Finally a statistical 'model'

How does weight change with age and sex

First a plot...

Scatterplot - age vs glucose - with fitted lines
```{r}
ggplot(alien) +
  aes(x = age, y = glucose, colour = sex) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Alien glucose vs age")
```

Then a simple linear model with age and sex as predictors...

```{r}
mod <- lm(weight ~ age + sex, data = alien)
```

```{r}
summary(mod)
```
```{r}
res <- residuals(mod)


qplot(res) +
  labs(title = "Residuals from simple linear model",
       x = "residual")
```







